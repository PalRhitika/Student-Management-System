{% extends "base.html" %}
{% load static %}


{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<div class="container my-5">

  <!-- Student Basic Info -->
  <div class="card mb-4 shadow-sm ">
    <div class="card-header bg-primary text-white">
      <h3>{{ object.first_name }} {{ object.last_name }}</h3>
    </div>
    <div class="card-body">
      <p><strong>Email:</strong> {{ object.email }}</p>
      <p><strong>Date of Birth:</strong> {{ object.dob|date:"F j, Y" }}</p>
    </div>
  </div>

  <!-- Academic History -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-success text-white">
      <h4>Academic History</h4>
    </div>
    <div class="card-body">
      {% if object.enrollments.all %}
      <table class="table table-striped table-bordered">
        <thead class="table-primary">
          <tr>
            <th>Course Code</th>
            <th>Course Name</th>
            <th>Exam Score</th>
            <th>Grade</th>
            <th>Other Details</th>
          </tr>
        </thead>
        <tbody>
          {% for enrollment in object.enrollments.all %}
          <tr>
            <td>{{ enrollment.course.course_code }}</td>
            <td>{{ enrollment.course.course_name }}</td>
            <td>{{ enrollment.exam_score|default:"-" }}</td>
            <td>{{ enrollment.grade|default:"-" }}</td>
            <td>
              {% if enrollment.metadata.all %}
              <ul class="mb-0">
                {% for m in enrollment.metadata.all %}
                <li>{{ m.key }}: {{ m.value }}</li>
                {% endfor %}
              </ul>
              {% else %} - {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <!-- Academic History Chart -->
      <div class="card mb-4 shadow-sm">
        <div class="card-header text-dark">
          <h4>Grades Overview</h4>
        </div>
        <div class="card-body">
          <canvas id="gradesChart" width="400" height="200"></canvas>
        </div>
      </div>
 <!-- charts  -->
      <script>
        const ctx = document.getElementById('gradesChart').getContext('2d');
        const gradesChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [
                    {% for enrollment in object.enrollments.all %}
                        "{{ enrollment.course.course_code }}"{% if not forloop.last %},{% endif %}
                    {% endfor %}
                ],
                datasets: [{
                    label: 'Exam Score',
                    data: [
                       {% for enrollment in object.enrollments.all %}
                            {{ enrollment.exam_score|default:"0" }}{% if not forloop.last %},{% endif %}
                        {% endfor %}
                    ],
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });
      </script>

      {% else %}
      <p class="text-muted">No courses enrolled yet.</p>
      {% endif %}
    </div>
  </div>

  <!-- Other -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-info text-white" >
      <h4>Additional Information</h4>
    </div>
    <div class="card-body">
      {% if object.metadata.all %}
      <ul>
        {% for m in object.metadata.all %}
        <li><strong>{{ m.key }}:</strong> {{ m.value }}</li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-muted">No additional metadata available.</p>
      {% endif %}
    </div>
  </div>


</div>
{% include "includes/base_delete_modal.html" %} {% endblock %}
